
# JSP и Facelets в JSF-приложениях

В [[JavaServer Faces (JSF)]] технология представления (View Definition Language, VDL) отвечает за то, как определяются и строятся страницы с UI-компонентами. Исторически JSF начинал с поддержки [[JSP]], но позже перешел на [[Facelets]], которые стали стандартом.

---

## 1. Использование JSP-страниц (устаревший подход)

На заре своего развития (JSF 1.x) фреймворк использовал JSP в качестве основного способа создания страниц. Разработчики вставляли JSF-теги (из библиотек `core` и `html`) прямо в `.jsp` файлы.

**Как это работало:**
JSF-теги внутри JSP обрабатывались как кастомные JSP-теги. Веб-контейнер сначала транслировал JSP-страницу в Java-сервлет, и только потом этот сервлет строил дерево JSF-компонентов.

### ❌ Ключевые проблемы и недостатки JSP в JSF:

1.  **Конфликт жизненных циклов**: У JSP есть свой жизненный цикл (трансляция в сервлет, выполнение), а у JSF — свой, гораздо более сложный (восстановление вида, применение значений, валидации и т.д.). Эти два жизненных цикла плохо сочетались, что приводило к путанице и неожиданному поведению.
2.  **Смешение логики и представления**: JSP поощрял использование **скриплетов** (`<% ... %>`) — вставок чистого Java-кода прямо в HTML-разметку. Это нарушало принцип разделения логики и представления и делало код грязным и трудным для поддержки.
3.  **Ограниченные возможности шаблонизации**: Стандартные механизмы JSP (`<jsp:include>`) были примитивны и не подходили для создания сложных, переиспользуемых шаблонов страниц (шапка, подвал, меню).
4.  **Вербозность и "мусор" в разметке**: JSP мог генерировать лишние символы (например, пробелы) в итоговом HTML, что иногда ломало верстку.
5.  **Затрудненная отладка**: Ошибки могли возникать как на этапе трансляции JSP, так и на этапе выполнения JSF-цикла, что усложняло поиск проблем.

**Статус**: Использование JSP для JSF **считается устаревшим (deprecated)** начиная с JSF 2.0 и **не рекомендуется** для новых проектов.

---

## 2. Использование Facelets-шаблонов (современный стандарт)

**Facelets** — это технология представления, созданная **специально для JSF**. Она была настолько успешной, что начиная с JSF 2.0 стала стандартным VDL по умолчанию. Facelets используют файлы с расширением `.xhtml`.

**Как это работает:**
Facelets — это XML-документы. JSF напрямую парсит `.xhtml` файл и строит из него дерево UI-компонентов, минуя фазу трансляции в сервлет. Этот процесс гораздо более чистый и интегрированный.

### ✅ Преимущества Facelets:

1.  **Мощная система шаблонизации**: Это главное преимущество. Facelets позволяют легко создавать шаблоны и переиспользовать части интерфейса.
    -   `<ui:composition template="...">`: Указывает, что данный файл является страницей, использующей определенный шаблон.
    -   `<ui:define name="...">`: Определяет контент для именованной области в шаблоне.
    -   `<ui:insert name="...">`: Вставляет контент из `<ui:define>` в шаблон.
    -   `<ui:include src="...">`: Включает содержимое другого файла (например, меню).

2.  **Чистое разделение**: Facelets не поддерживают скриплеты. Вся логика находится в бэкенд-бинах (Managed Beans), а `.xhtml` файлы отвечают только за декларативное описание интерфейса.
3.  **Разработано для компонентов**: Вся философия Facelets построена вокруг идеи сборки страницы из компонентов, что идеально соответствует архитектуре JSF.
4.  **Улучшенная отладка**: Поскольку `.xhtml` — это валидный XML, ошибки в разметке обнаруживаются на этапе парсинга с точным указанием строки и символа.
5.  **Производительность**: Отсутствие шага компиляции JSP в сервлет ускоряет развертывание и первый запуск приложения.

### Пример шаблонизации с Facelets

**Файл шаблона `template.xhtml`:**
```xml
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets">
<h:head>
    <title><ui:insert name="title">Default Title</ui:insert></title>
</h:head>
<h:body>
    <div id="header">
        <h1>My Awesome App</h1>
    </div>
    
    <div id="content">
        <ui:insert name="content">Default Content</ui:insert>
    </div>

    <div id="footer">
        <p>Copyright 2023</p>
    </div>
</h:body>
</html>

```

## Сравнительная таблица

|   |   |   |
|---|---|---|
|Критерий|JSP в JSF|Facelets в JSF|
|**Статус**|Устаревший (legacy)|**Стандарт де-факто и де-юре**|
|**Основная технология**|Компиляция в сервлет|Прямой парсинг XML и построение дерева компонентов|
|**Шаблонизация**|Примитивная (<jsp:include>)|**Мощная и гибкая** (<ui:composition>, <ui:define>)|
|**Разделение логики**|Поощряет смешение через скриплеты|**Строгое разделение** (нет скриплетов)|
|**Обработка ошибок**|Сложнее, ошибки на нескольких уровнях|Проще, точные сообщения об ошибках парсинга XML|
|**Интеграция с JSF**|Неполная, конфликт жизненных циклов|**Бесшовная**, созданы друг для друга|

### Вывод

Для любого современного JSF-приложения (версии 2.0 и выше) **выбор однозначен — Facelets**. Они предоставляют мощный, чистый и эффективный способ построения пользовательских интерфейсов, который полностью соответствует компонентной природе фреймворка. JSP следует рассматривать только при работе с очень старыми, унаследованными проектами.